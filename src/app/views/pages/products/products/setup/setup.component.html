<app-breadcrumb></app-breadcrumb>

<div class="row">
  <div class="col-md-12 stretch-card">
    <div class="card">
      <div class="card-body">
        <form class="forms-sample" (submit)="onSubmit($event)">
          <input type="hidden" name="update_id" [(ngModel)]="currentRecord.id">

          <div class="row">
            <div class="col-md-3 mb-3">
              <label class="form-label">Code / SKU <span class="text-danger">*</span></label>
              <input type="text" class="form-control" name="code" [(ngModel)]="currentRecord.code" (ngModelChange)="clearError('code')">
              <div class="text-danger mt-1" *ngIf="formErrors.code">{{ formErrors.code[0] }}</div>
            </div>

            <div class="col-md-3 mb-3">
              <label class="form-label">Product Name <span class="text-danger">*</span></label>
              <input type="text" class="form-control" name="name" [(ngModel)]="currentRecord.name" (ngModelChange)="clearError('name')">
              <div class="text-danger mt-1" *ngIf="formErrors.name">{{ formErrors.name[0] }}</div>
            </div>

            <div class="col-md-3 mb-3">
              <label class="form-label">Brand</label>
              <ng-select
                [items]="brands"
                bindLabel="name"
                bindValue="id"
                [(ngModel)]="currentRecord.brand_id"
                name="brand_id"
                placeholder="Select one"
                [searchable]="true"
                (change)="clearError('brand_id')">
              </ng-select>
              <div class="text-danger mt-1" *ngIf="formErrors.brand_id">{{ formErrors.brand_id[0] }}</div>
            </div>

            <div class="col-md-3 mb-3">
              <label class="form-label">Category <span class="text-danger">*</span></label>
              <ng-select
                [items]="categories"
                bindLabel="name"
                bindValue="id"
                [(ngModel)]="currentRecord.category_id"
                name="category_id"
                placeholder="Select one"
                [searchable]="true"
                (change)="clearError('category_id')">
              </ng-select>
              <div class="text-danger mt-1" *ngIf="formErrors.category_id">{{ formErrors.category_id[0] }}</div>
            </div>

            <div class="col-md-3 mb-3">
              <label class="form-label">Unit <span class="text-danger">*</span></label>
              <ng-select
                [items]="units"
                bindLabel="name"
                bindValue="id"
                [(ngModel)]="currentRecord.unit_id"
                name="unit_id"
                placeholder="Select one"
                [searchable]="true"
                (change)="clearError('unit_id')">
              </ng-select>
              <div class="text-danger mt-1" *ngIf="formErrors.unit_id">{{ formErrors.unit_id[0] }}</div>
            </div>

            <div class="col-md-3 mb-3">
              <label class="form-label">Quantity <span class="text-danger">*</span></label>
              <input type="number" class="form-control" [(ngModel)]="currentRecord.stock" name="stock" (ngModelChange)="clearError('stock')">
              <div class="text-danger mt-1" *ngIf="formErrors.stock">{{ formErrors.stock[0] }}</div>
            </div>

            <div class="col-md-3 mb-3">
              <label class="form-label">Price <span class="text-danger">*</span></label>
              <input type="number" class="form-control" [(ngModel)]="currentRecord.cost_price" name="cost_price" (ngModelChange)="clearError('cost_price')">
              <div class="text-danger mt-1" *ngIf="formErrors.cost_price">{{ formErrors.cost_price[0] }}</div>
            </div>

            <div class="col-md-3 mb-3">
              <label class="form-label">Sale Price <span class="text-danger">*</span></label>
              <input type="number" class="form-control" [(ngModel)]="currentRecord.selling_price" name="selling_price" (ngModelChange)="clearError('selling_price')">
              <div class="text-danger mt-1" *ngIf="formErrors.selling_price">{{ formErrors.selling_price[0] }}</div>
            </div>
            
            <div class="col-md-3 mb-3">
              <label class="form-label">Status <span class="text-danger">*</span></label>
              <ng-select
                [items]="status"
                bindLabel="name"
                bindValue="id"
                [(ngModel)]="currentRecord.status"
                name="status"
                placeholder="Select one"
                [searchable]="false"
                (change)="clearError('status')">
              </ng-select>
              <div class="text-danger mt-1" *ngIf="formErrors.status">{{ formErrors.status[0] }}</div>
            </div>

            <div class="col-md-12 mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" name="description" rows="3" [(ngModel)]="currentRecord.description" (ngModelChange)="clearError('description')"></textarea>
              <div class="text-danger mt-1" *ngIf="formErrors.description">{{ formErrors.description[0] }}</div>
            </div>

            <!-- Image Upload -->
            <div class="col-md-12 mb-3">
              <label class="form-label">Upload Image</label>
              <input type="file" class="form-control" (change)="onFileSelected($event)">
              <div class="text-danger mt-1" *ngIf="formErrors.image">{{ formErrors.image[0] }}</div>

              <!-- Image Preview -->
              <div class="mt-3" *ngIf="imagePreview">
                <img [src]="imagePreview" alt="Product Image" class="img-thumbnail" style="max-width: 150px;">
              </div>
            </div>

            <!-- Form Actions -->
            <div class="col-12 mt-3">
              <button type="submit" [disabled]="isLoading" class="btn btn-primary">Save Product</button>
            </div>

            <div class="col-12 mt-3" *ngIf="globalErrorMessage">
              <div class="alert alert-danger text-center">
                {{ globalErrorMessage }}
              </div>
            </div>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>